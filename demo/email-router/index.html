<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Email router (client-side)</title>
  <link rel="stylesheet" href="/styles.css?v=final3">
</head>
<body class="section">
  <div class="container">
    <h1>Email router — démo</h1>
    <p>Collez un e-mail. La classification est faite 100% dans votre navigateur.</p>
    <textarea id="txt" rows="10" style="width:100%"></textarea>
    <button class="btn" id="go" style="margin-top:8px">Classer</button>
    <div id="out" class="card" style="margin-top:12px; padding:12px"></div>
    <p class="muted">Labels: Invoice · Support · Sales · HR · Other</p>
  </div>

  <script type="module">
    import { pipeline } from "https://cdn.jsdelivr.net/npm/@xenova/transformers@2.15.0";

    let clf;
    const labels = ['Invoice','Support','Sales','HR','Other']; // mapping target
    const out = document.getElementById('out');
    document.getElementById('go').addEventListener('click', async () => {
      out.textContent = 'Loading model / predicting…';
      if (!clf) clf = await pipeline('text-classification', 'Xenova/distilbert-base-uncased-finetuned-sst-2-english'); // demo model
      const text = document.getElementById('txt').value || 'Hello, I have an issue with my invoice…';
      const res = await clf(text, { topk: 1 });
      // Map demo labels heuristically (simple rule, fine for a demo)
      const t = text.toLowerCase();
      let label = 'Other';
      if (t.includes('invoice') || t.includes('bill')) label = 'Invoice';
      else if (t.includes('issue') || t.includes('bug') || t.includes('problem') || t.includes('support')) label = 'Support';
      else if (t.includes('quote') || t.includes('pricing') || t.includes('demo')) label = 'Sales';
      else if (t.includes('payroll') || t.includes('vacation') || t.includes('contract')) label = 'HR';
      out.innerHTML = `
        <strong>Predicted route:</strong> ${label}<br>
        <small>Next step: <em>${label === 'Invoice' ? 'Create ticket: Finance/AP' :
                                label === 'Support' ? 'Create ticket: Helpdesk' :
                                label === 'Sales'   ? 'Create lead/opportunity (CRM)' :
                                label === 'HR'      ? 'Forward to HR mailbox' : 'Triage backlog'}</em></small>`;
    });
  </script>
</body>
</html>
